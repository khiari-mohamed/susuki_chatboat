export const tunisianDictionary = {
  // Car parts - Pièces de rechange
  'retrviseur': 'rétroviseur',
  'retroviseur': 'rétroviseur',
  'frin': 'frein',
  'frein': 'frein',
  'zit': 'huile',
  'zit moteur': 'huile moteur',
  'batri': 'batterie',
  'batterie': 'batterie',
  'klaxon': 'klaxon',
  'capot': 'capot',
  'pneu': 'pneu',
  'roue': 'roue',
  'filtre': 'filtre',
  'bougie': 'bougie',
  'courroie': 'courroie',
  'amortisseur': 'amortisseur',
  'plaquette': 'plaquette de frein',
  'disque': 'disque de frein',
  'phare': 'phare',
  'feu': 'feu',
  'pare-choc': 'pare-choc',
  'pare-brise': 'pare-brise',
  'vitre': 'vitre',
  'portière': 'portière',
  'siège': 'siège',
  'volant': 'volant',
  'pédale': 'pédale',
  'embrayage': 'embrayage',
  'boîte': 'boîte de vitesses',
  'moteur': 'moteur',
  'radiateur': 'radiateur',
  'ventilateur': 'ventilateur',
  'alternateur': 'alternateur',
  'démarreur': 'démarreur',
  'carburateur': 'carburateur',
  'injection': 'injection',
  'échappement': 'échappement',
  'pot': 'pot d\'échappement',
  'catalyseur': 'catalyseur',
  'suspension': 'suspension',
  'direction': 'direction',
  'transmission': 'transmission',
  'différentiel': 'différentiel',
  'joint': 'joint',
  'roulement': 'roulement',
  'silent-bloc': 'silent-bloc',
  'rotule': 'rotule',
  'biellette': 'biellette',
  'triangle': 'triangle de suspension',
  'barre': 'barre stabilisatrice',
  'ressort': 'ressort',
  'combiné': 'combiné fileté',
  'moyeu': 'moyeu',
  'étrier': 'étrier de frein',
  'maître-cylindre': 'maître-cylindre',
  'servo-frein': 'servo-frein',
  'abs': 'ABS',
  'esp': 'ESP',
  'airbag': 'airbag',
  'ceinture': 'ceinture de sécurité',
  'climatisation': 'climatisation',
  'chauffage': 'chauffage',
  'ventilation': 'ventilation',
  'compresseur': 'compresseur',
  'condenseur': 'condenseur',
  'évaporateur': 'évaporateur',
  'détendeur': 'détendeur',
  'filtre habitacle': 'filtre habitacle',
  'thermostat': 'thermostat',
  'pompe': 'pompe',
  'durite': 'durite',
  'courroie distribution': 'courroie de distribution',
  'galet': 'galet',
  'tendeur': 'tendeur',
  'poulie': 'poulie',
  'vilebrequin': 'vilebrequin',
  'arbre à cames': 'arbre à cames',
  'soupape': 'soupape',
  'piston': 'piston',
  'segment': 'segment',
  'bielle': 'bielle',
  'culasse': 'culasse',
  'joint de culasse': 'joint de culasse',
  'carter': 'carter',
  'vidange': 'vidange',
  'révision': 'révision',
  'entretien': 'entretien',
  'réparation': 'réparation',
  'diagnostic': 'diagnostic',
  'contrôle technique': 'contrôle technique',
  'garantie': 'garantie',
  'pièce origine': 'pièce d\'origine',
  'pièce adaptable': 'pièce adaptable',
  'neuf': 'neuf',
  'occasion': 'occasion',
  'échange standard': 'échange standard',

  // Tunisian expressions
  'nheb': 'je veux',
  'n7eb': 'je veux',
  'n7ebk': 'je veux',
  't3aweni': 'aider',
  'nfasakh': 'chercher',
  'ch7al': 'combien',
  'choufli': 'montre-moi',
  'ken famma': 'est-ce qu\'il y a',
  'lel': 'pour le',
  'prix': 'prix',
  '3andkom': 'avez-vous',
  'stock': 'stock',
  'disponible': 'disponible',
  'mawjoud': 'disponible',
  'kifech': 'comment',
  'waqtech': 'quand',
  'fama': 'il y a',
  'famma': 'il y a',
  'mafamech': 'il n\'y a pas',
  'mafamma': 'il n\'y a pas',
  'behi': 'bien',
  'barcha': 'beaucoup',
  'chwaya': 'un peu',
  'zeda': 'aussi',
  'ama': 'mais',
  'walla': 'ou',
  'w': 'et',
  'eli': 'qui',
  'hedha': 'ceci',
  'hedheka': 'cela',
  'hne': 'ici',
  'hnek': 'là-bas',
  'tawa': 'maintenant',
  'ghoudwa': 'demain',
  'el bareh': 'hier',
  'lyoum': 'aujourd\'hui',
  'nhar': 'jour',
  'lil': 'nuit',
  'sbah': 'matin',
  '3chiya': 'soir',
  'jom3a': 'vendredi',
  'sabt': 'samedi',
  '7ad': 'dimanche',
  'thnin': 'lundi',
  'thlatha': 'mardi',
  'arb3a': 'mercredi',
  'khmis': 'jeudi',

  // Common misspellings and variations
  'retrovisseur': 'rétroviseur',
  'retrovisor': 'rétroviseur',
  'miroir': 'rétroviseur',
  'frains': 'freins',
  'frins': 'freins',
  'brake': 'frein',
  'brakes': 'freins',
  'brake pad': 'plaquette de frein',
  'brake pads': 'plaquettes de frein',
  'oil': 'huile',
  'engine oil': 'huile moteur',
  'battery': 'batterie',
  'baterie': 'batterie',
  'tire': 'pneu',
  'tyre': 'pneu',
  'wheel': 'roue',
  'filter': 'filtre',
  'spark plug': 'bougie',
  'belt': 'courroie',
  'shock': 'amortisseur',
  'shock absorber': 'amortisseur',
  'headlight': 'phare',
  'light': 'feu',
  'bumper': 'pare-choc',
  'windshield': 'pare-brise',
  'window': 'vitre',
  'door': 'portière',
  'seat': 'siège',
  'steering wheel': 'volant',
  'pedal': 'pédale',
  'clutch': 'embrayage',
  'gearbox': 'boîte de vitesses',
  'engine': 'moteur',
  'radiator': 'radiateur',
  'fan': 'ventilateur',
  'alternator': 'alternateur',
  'starter': 'démarreur',
  'carburetor': 'carburateur',
  'exhaust': 'échappement',
  'steering': 'direction',
  'differential': 'différentiel',
  'bearing': 'roulement',
  'spring': 'ressort',
  'brake disc': 'disque de frein',
  'brake caliper': 'étrier de frein',
  'master cylinder': 'maître-cylindre',
  'seatbelt': 'ceinture de sécurité',
  'air conditioning': 'climatisation',
  'heating': 'chauffage',
  'compressor': 'compresseur',
  'pump': 'pompe',
  'timing belt': 'courroie de distribution',
  'pulley': 'poulie',
  'crankshaft': 'vilebrequin',
  'camshaft': 'arbre à cames',
  'valve': 'soupape',
  'connecting rod': 'bielle',
  'cylinder head': 'culasse',
  'head gasket': 'joint de culasse',
  'oil pan': 'carter',
  'service': 'entretien',
  'maintenance': 'entretien',
  'repair': 'réparation',
  'diagnosis': 'diagnostic',
  'warranty': 'garantie',
  'original part': 'pièce d\'origine',
  'aftermarket part': 'pièce adaptable',
  'new': 'neuf',
  'used': 'occasion',
  'remanufactured': 'échange standard'
};

export const normalizeText = (text: string): string => {
  let normalized = text.toLowerCase().trim();
  
  // Replace common Tunisian expressions
  Object.entries(tunisianDictionary).forEach(([tunisian, french]) => {
    const regex = new RegExp(`\\b${tunisian}\\b`, 'gi');
    normalized = normalized.replace(regex, french);
  });
  
  return normalized;
};

export const findSimilarParts = (query: string, parts: string[]): string[] => {
  const normalized = normalizeText(query);
  
  return parts.filter(part => {
    const normalizedPart = normalizeText(part);
    return normalizedPart.includes(normalized) || 
           normalized.includes(normalizedPart) ||
           levenshteinDistance(normalized, normalizedPart) <= 2;
  });
};

function levenshteinDistance(str1: string, str2: string): number {
  const matrix: number[][] = [];
  
  for (let i = 0; i <= str2.length; i++) {
    matrix[i] = [i];
  }
  
  for (let j = 0; j <= str1.length; j++) {
    matrix[0][j] = j;
  }
  
  for (let i = 1; i <= str2.length; i++) {
    for (let j = 1; j <= str1.length; j++) {
      if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
        matrix[i][j] = matrix[i - 1][j - 1];
      } else {
        matrix[i][j] = Math.min(
          matrix[i - 1][j - 1] + 1,
          matrix[i][j - 1] + 1,
          matrix[i - 1][j] + 1
        );
      }
    }
  }
  
  return matrix[str2.length][str1.length];
}